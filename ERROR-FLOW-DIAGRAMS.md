# 🔄 Error Handling Flow Diagrams

## 1. Complete Error Flow Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         USER ACTION                             │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    REACT ROUTER                                  │
│  • Matches route                                                │
│  • Loads component                                              │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  Protected?     │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ YES          │              │ NO
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│ Authenticated?│ │Permission?│  │ Render   │
└──────┬───────┘ └─────┬────┘  │Component │
       │               │        └──────────┘
  ┌────┼────┐     ┌────┼────┐
  │YES │ NO │     │YES │ NO │
  │    │    │     │    │    │
  ▼    ▼    ▼     ▼    ▼    ▼
┌────┐ ┌────┐  ┌────┐ ┌──────────────┐
│Next│ │/   │  │Cont│ │/unauthorized │
│    │ │login│  │inue│ └──────────────┘
└─┬──┘ └────┘  └─┬──┘
  │             │
  └──────┬──────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    COMPONENT RENDERS                             │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              ErrorBoundary Wrapper                        │  │
│  │  Catches: React rendering errors, lifecycle errors        │  │
│  └──────────────────────────────────────────────────────────┘  │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  Error Occurs?  │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ YES          │              │ NO
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│ Render Error │ │Show Error│  │ Success  │
│  Boundary    │ │ Fallback │  │  Render  │
└──────────────┘ └──────────┘  └──────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  API Call?      │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ YES          │              │ NO
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│ API Service  │ │  Success │  │Continue  │
│Error Handler │ └──────────┘  └──────────┘
└──────┬───────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ERROR CATEGORIZATION                          │
│                                                                  │
│  401 → Logout → /login                                          │
│  403 → /unauthorized                                            │
│  404 → Component handles or show toast                          │
│  500+ → /server-error                                           │
│  Network → /network-error                                       │
│  Other → Toast + optional redirect                             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. API Error Flow Detail

```
┌─────────────────────────────────────────────────────────────────┐
│                      API REQUEST                                 │
│  fetch(url, config)                                             │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  Network OK?    │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ NO           │              │ YES
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│TypeError:    │ │Continue  │  │Response  │
│Failed to     │ └──────────┘  │ Received │
│fetch         │               └─────┬────┘
└──────┬───────┘                     │
       │                             │
       ▼                             ▼
┌──────────────┐            ┌────────┴────────┐
│/network-error│            │  Check Status   │
└──────────────┘            └────────┬────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    │                │                │
                    ▼                ▼                ▼
              ┌──────────┐    ┌──────────┐    ┌──────────┐
              │   401    │    │   403    │    │   404    │
              │Unauthorized│   │Forbidden │    │Not Found │
              └─────┬────┘    └─────┬────┘    └─────┬────┘
                    │               │               │
                    ▼               ▼               ▼
              ┌──────────┐    ┌──────────┐    ┌──────────┐
              │ Logout + │    │   Go to  │    │  Throw   │
              │ /login   │    │/unauthorized│  │  Error   │
              └──────────┘    └──────────┘    └──────────┘
                    │
                    │         ┌────────────────┐
                    └─────────┤   500-599      │
                              │  Server Error  │
                              └────────┬───────┘
                                       │
                                       ▼
                              ┌──────────────────┐
                              │  /server-error   │
                              └──────────────────┘
```

---

## 3. Protected Route Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                   <ProtectedRoute>                               │
│  Props: requireAdmin?, roles?[]                                 │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │   Loading?      │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ YES          │              │ NO
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│Show Spinner  │ │Continue  │  │Continue  │
└──────────────┘ └──────────┘  └─────┬────┘
                                      │
                                      ▼
                             ┌────────┴────────┐
                             │  User exists?   │
                             └────────┬────────┘
                                      │
                       ┌──────────────┼──────────────┐
                       │ NO           │              │ YES
                       ▼              ▼              ▼
                 ┌──────────┐   ┌──────────┐  ┌──────────┐
                 │Navigate  │   │Continue  │  │Continue  │
                 │to /login │   └──────────┘  └─────┬────┘
                 └──────────┘                        │
                                                     ▼
                                            ┌────────┴────────┐
                                            │ requireAdmin?   │
                                            └────────┬────────┘
                                                     │
                                      ┌──────────────┼──────────────┐
                                      │ YES          │              │ NO
                                      ▼              ▼              ▼
                                 ┌──────────┐  ┌──────────┐  ┌──────────┐
                                 │Is Admin? │  │Continue  │  │Continue  │
                                 └─────┬────┘  └──────────┘  └─────┬────┘
                                       │                            │
                                ┌──────┼──────┐                     │
                                │ YES  │  NO  │                     │
                                │      │      │                     ▼
                                ▼      ▼      ▼            ┌────────┴────────┐
                          ┌──────┐ ┌──────────────┐       │  roles[] check  │
                          │Render│ │/unauthorized │       └────────┬────────┘
                          │Child │ └──────────────┘                │
                          └──────┘                          ┌──────┼──────┐
                                                            │ YES  │  NO  │
                                                            │      │      │
                                                            ▼      ▼      ▼
                                                      ┌──────┐ ┌──────────────┐
                                                      │Render│ │/unauthorized │
                                                      │Child │ └──────────────┘
                                                      └──────┘
```

---

## 4. Error Handler Hook Flow

```
┌─────────────────────────────────────────────────────────────────┐
│              useErrorHandler() Hook                              │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  Error Caught   │
              └────────┬────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │ AbortError?     │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ YES          │              │ NO
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│ Ignore       │ │Continue  │  │Continue  │
│ (Expected)   │ └──────────┘  └─────┬────┘
└──────────────┘                     │
                                     ▼
                            ┌────────┴────────┐
                            │ Categorize Error│
                            └────────┬────────┘
                                     │
              ┌──────────────────────┼──────────────────────┐
              │                      │                      │
              ▼                      ▼                      ▼
       ┌────────────┐         ┌────────────┐       ┌────────────┐
       │  Network   │         │  401/403   │       │  404/500   │
       │   Error    │         │   Error    │       │   Error    │
       └──────┬─────┘         └──────┬─────┘       └──────┬─────┘
              │                      │                     │
              ▼                      ▼                     ▼
       ┌────────────┐         ┌────────────┐       ┌────────────┐
       │Show Toast  │         │Show Toast  │       │Show Toast  │
       │+ Redirect  │         │+ Redirect  │       │+ Redirect  │
       │/network-   │         │/unauthorized│       │Appropriate │
       │error       │         │or /login   │       │Error Page  │
       └────────────┘         └────────────┘       └────────────┘
              │                      │                     │
              └──────────────────────┴─────────────────────┘
                                     │
                                     ▼
                            ┌────────┴────────┐
                            │ Options Check   │
                            └────────┬────────┘
                                     │
                      ┌──────────────┼──────────────┐
                      │              │              │
                      ▼              ▼              ▼
               ┌────────────┐ ┌────────────┐ ┌────────────┐
               │ showToast? │ │ redirect?  │ │ callback?  │
               └──────┬─────┘ └──────┬─────┘ └──────┬─────┘
                      │              │              │
               ┌──────┼──────┐       │              │
               │ YES  │  NO  │       │              │
               │      │      │       │              │
               ▼      ▼      ▼       ▼              ▼
          ┌──────┐ ┌──────┐ ┌──────────┐    ┌──────────┐
          │Toast │ │Skip  │ │Navigate  │    │Execute   │
          │Alert │ └──────┘ │or Skip   │    │Callback  │
          └──────┘          └──────────┘    └──────────┘
```

---

## 5. Network Error Detection Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                   NetworkError Page                              │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │   Component     │
              │   Mounts        │
              └────────┬────────┘
                       │
                       ▼
       ┌───────────────────────────────────┐
       │  useState(navigator.onLine)       │
       │  Initial: true/false              │
       └───────────────┬───────────────────┘
                       │
                       ▼
       ┌───────────────────────────────────┐
       │  useEffect: Add listeners         │
       │  • window.addEventListener        │
       │    ('online', handleOnline)       │
       │  • window.addEventListener        │
       │    ('offline', handleOffline)     │
       └───────────────┬───────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  Wait for Event │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│ 'online'     │ │'offline' │  │User Click│
│  Event       │ │ Event    │  │ Retry    │
└──────┬───────┘ └─────┬────┘  └─────┬────┘
       │               │             │
       ▼               ▼             ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│setIsOnline   │ │setIsOnline│ │ Fetch    │
│   (true)     │ │  (false) │  │/api/ping │
└──────┬───────┘ └─────┬────┘  └─────┬────┘
       │               │             │
       ▼               ▼             │
┌──────────────┐ ┌──────────┐       │
│Show: Online  │ │Show:     │       │
│   (Green)    │ │ Offline  │       │
│              │ │  (Red)   │       │
└──────────────┘ └──────────┘       │
                                    │
                                    ▼
                           ┌────────┴────────┐
                           │  Response OK?   │
                           └────────┬────────┘
                                    │
                     ┌──────────────┼──────────────┐
                     │ YES          │              │ NO
                     ▼              ▼              ▼
              ┌──────────┐   ┌──────────┐  ┌──────────┐
              │ Navigate │   │Continue  │  │Show Error│
              │ to /     │   └──────────┘  │  Toast   │
              └──────────┘                 └──────────┘
```

---

## 6. User Journey: 403 Error

```
USER STORY: Author tries to access Admin panel

┌─────────────────────────────────────────────────────────────────┐
│ 1. User clicks "Admin Panel" link in navbar                     │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│ 2. React Router navigates to /admin                            │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│ 3. ProtectedRoute component checks:                            │
│    ✅ user exists (logged in)                                   │
│    ✅ requireAdmin = true                                       │
│    ❌ user.role = "author" (not "admin")                       │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│ 4. ProtectedRoute returns:                                      │
│    <Navigate to="/unauthorized" replace />                      │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│ 5. Unauthorized page loads                                      │
│    • Shows 🛡️ + 🔒 icons (animated)                           │
│    • Shows "403" in red gradient                               │
│    • Shows "Accès refusé" title                                │
│    • Message: "Insufficient permissions"                       │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│ 6. useAuth() detects user is authenticated                     │
│    Shows context-aware message:                                │
│    • "You don't have required permissions"                     │
│    • Tips: Contact admin, return to dashboard, etc.            │
│    • No "Login" button (already logged in)                     │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────┐
│ 7. User sees action buttons:                                   │
│    [← Retour]  [🏠 Accueil]                                    │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  User Chooses   │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│Click "Back"  │ │Click     │  │Contact   │
│Go to prev    │ │"Home"    │  │Admin     │
│page          │ │Navigate  │  │(Manual)  │
│              │ │to /      │  │          │
└──────────────┘ └──────────┘  └──────────┘
```

---

## 7. Component Error Boundary Lifecycle

```
┌─────────────────────────────────────────────────────────────────┐
│              Component Rendering                                 │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
              ┌────────┴────────┐
              │  Error Thrown?  │
              └────────┬────────┘
                       │
        ┌──────────────┼──────────────┐
        │ NO           │              │ YES
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐  ┌──────────┐
│Render Normal │ │Continue  │  │Error     │
└──────────────┘ └──────────┘  │Boundary  │
                                └─────┬────┘
                                      │
                                      ▼
                        ┌─────────────────────────┐
                        │ componentDidCatch()     │
                        │ • Log error to console  │
                        │ • Set hasError = true   │
                        │ • Increment errorCount  │
                        │ • Store error & info    │
                        └──────────┬──────────────┘
                                   │
                                   ▼
                        ┌─────────────────────────┐
                        │ getDerivedStateFromError│
                        │ Returns: { hasError }   │
                        └──────────┬──────────────┘
                                   │
                                   ▼
                        ┌─────────────────────────┐
                        │   render() method       │
                        │   if hasError:          │
                        │     return ErrorFallback│
                        │   else:                 │
                        │     return children     │
                        └──────────┬──────────────┘
                                   │
                                   ▼
                        ┌─────────────────────────┐
                        │   ErrorFallback UI      │
                        │  • Show 🐛 Bug icon     │
                        │  • Show error message   │
                        │  • Show action buttons  │
                        │  • errorCount > 2?      │
                        │    Show warning         │
                        └──────────┬──────────────┘
                                   │
                                   ▼
                           ┌───────┴────────┐
                           │  User Action   │
                           └───────┬────────┘
                                   │
                ┌──────────────────┼──────────────────┐
                │                  │                  │
                ▼                  ▼                  ▼
         ┌────────────┐     ┌────────────┐    ┌────────────┐
         │Click       │     │Click       │    │Click       │
         │"Try Again" │     │"Go Home"   │    │"Reload"    │
         └──────┬─────┘     └──────┬─────┘    └──────┬─────┘
                │                  │                  │
                ▼                  ▼                  ▼
         ┌────────────┐     ┌────────────┐    ┌────────────┐
         │handleReset │     │navigate    │    │window      │
         │• hasError  │     │   ('/')    │    │.location   │
         │  = false   │     └────────────┘    │.reload()   │
         │• errorCount│                       └────────────┘
         │  ++        │
         └────────────┘
```

---

**These diagrams show the complete error flow through the DictCoaching application! 🎯**
